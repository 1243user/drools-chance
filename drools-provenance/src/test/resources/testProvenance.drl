package org.drools.beliefs.provenance;

import org.drools.core.factmodel.traits.Entity
import com.foo.SubKlass;
import org.test.KlassImpl;
import org.test.Klass;
import org.test.Klass_;
import com.foo.SubKlass_;
import org.drools.core.metadata.Modify;
import org.drools.beliefs.provenance.annotations.*;

global java.util.List list;

rule Init
when
then
    insertLogical( Klass_.newKlass( "123" ).prop( "hello" ) );
    insert( "fooo" );
end

rule Don
@Display( "Pretty print @{$e_1}" )
no-loop
when
    $e : Klass( $p : prop ) @Evidence( @Display( type="1", value="@{$p} world from @{$e.getClass().getSimpleName()}" ) )
    $s : String()
then
    insertLogical( SubKlass_.donSubKlass( $e ) );
end


rule SetAttribute
@Display( template = "anotherExample" )
when
    $e : SubKlass() @Evidence( value = { @Display( type="1", value = "hello" ), @Display( type="2", template = "example" ) } )
then
    insertLogical( SubKlass_.modify( $e ).subProp( 12 ) );
end

rule AnotherSetAttribute
when
    $k : SubKlass() @Evidence
then
    insertLogical( SubKlass_.modify( $k ).subProp( 42 ) );
end


rule React
when
    $k : SubKlass( subProp == 42 )
then
    list.add( "RESULT" );
end


rule NeverEver
when
    Modify()
then
    throw new IllegalStateException( "This rule should have never fired! : reified 'modifies' should never propagate directly" );
end